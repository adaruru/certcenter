<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <title>憑證服務操作說明</title>
  <link rel="icon" href="./public/certcenter.ico" type="image/x-icon">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #a8d8ff 0%, #bde4ff 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #fff;
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 40px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      letter-spacing: 1px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    th, td {
      padding: 20px 25px;
      vertical-align: top;
      border-bottom: 1px solid rgba(102, 126, 234, 0.1);
    }

    th {
      background: linear-gradient(135deg, #a8c0ff 0%, #c9a8ff 100%);
      color: #fff;
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.9rem;
    }

    th:first-child {
      border-radius: 20px 0 0 0;
    }

    th:last-child {
      border-radius: 0 20px 0 0;
    }

    td:first-child {
      width: 30%;
      font-weight: 500;
      color: #5a67d8;
    }

    tr:hover td {
      background: linear-gradient(90deg, rgba(167, 139, 250, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
    }

    tr:last-child td:first-child {
      border-radius: 0 0 0 20px;
    }

    tr:last-child td:last-child {
      border-radius: 0 0 20px 0;
    }

    code {
      background: linear-gradient(135deg, #e0e7ff 0%, #ede9fe 100%);
      color: #5b21b6;
      padding: 8px 12px;
      border-radius: 8px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9rem;
      display: inline-block;
      margin: 4px 0;
      border: 1px solid rgba(139, 92, 246, 0.2);
    }

    input[type="text"] {
      width: 100%;
      max-width: 400px;
      padding: 12px 16px;
      border: 2px solid #c9a8ff;
      border-radius: 10px;
      font-size: 1rem;
      background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
      color: #5b21b6;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #8b5cf6;
      box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
      transform: translateY(-2px);
    }

    button {
      margin-top: 8px;
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }

    button:active {
      transform: translateY(0);
    }

    #cleanResult {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
    }

    #cleanResult:hover {
      background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
    }

    .resultSpan {
      margin-left: 12px;
      padding: 6px 12px;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 6px;
      color: #92400e;
      font-weight: 500;
      display: inline-block;
      margin-top: 8px;
      font-size: 0.9rem;
      border: 1px solid rgba(251, 191, 36, 0.3);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    small {
      color: #7c3aed;
      display: block;
      margin-top: 8px;
      font-style: italic;
    }

    .reg-val {
      color: #c026d3;
      font-weight: 600;
      padding: 2px 6px;
      background: rgba(192, 38, 211, 0.1);
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }

      th, td {
        padding: 15px;
        font-size: 0.9rem;
      }

      td:first-child {
        width: 40%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>憑證服務操作說明</h1>
    <div id="baseURL" style="display:none">{{.BaseURL}}</div>
    <div class="card">
      <table>
    <tr>
      <th>步驟</th>
      <th>指令</th>
    </tr>
    <tr>
      <td>
        輸入你即將要申請的憑證網域
        <button id="cleanResult" type="button">清空所有結果</button>
      </td>
      <td>
        <input id="regDnSet" type="text" value="{{.RegDnSet}}" style="width:280px">
        <br><small>修改此值，下面所有命令中的網域會同步變更</small>
      </td>
    </tr>
    <tr>
      <td>0. FQDN</td>
      <td>
        Azure DNS zones Recordsets: add a CNAME record '_acme-challenge.&lt;your-domain&gt;' Alias {{.FQDN}}
      </td>
    </tr>
    <tr>
      <td>1. 帳號檢查: {{.ACME_ACCOUNT}}
        <button id="btnCheckReg" type="button">執行</button><br>
        <span id="checkResult" class="resultSpan"></span>
      </td>
      <td>
        <code>curl "{{.BaseURL}}/register"</code>
        <br>容器執行在 compose 階段決定註冊帳號，所以只能帳號檢查，不能註冊
      </td>
    </tr>
    <tr>
      <td>
        2. 憑證發行<button id="btnIssue" type="button">執行</button><br>
        <span id="issueResult" class="resultSpan"></span>
      </td>
      <td>
        <code>curl -X POST "{{.BaseURL}}/cert?domain=<span class="reg-val">{{.RegDnSet}}</span>"</code><br>
        請在 0.FQDN 步驟之後，確保 DNS 設定完成後再執行
      </td>
    </tr>
    <tr>
      <td>3. 憑證下載</td>
      <td>
        <code>curl -OJ "{{.BaseURL}}/cert?domain=<span class="reg-val">{{.RegDnSet}}</span>"</code>
      </td>
    </tr>
    <tr>
      <td>4. 憑證狀態</td>
      <td>
        <code>curl "{{.BaseURL}}/health?domain=<span class="reg-val">{{.RegDnSet}}</span>"</code><br>
        用於判斷是否可以下載憑證 (status: OK &gt;30天 / WARN ≤30天 / ERROR 已過期)
      </td>
    </tr>
    <tr>
      <td>
        5. 檢查到期<button id="btnExpire" type="button">執行</button><br>
        <span id="expireResult" class="resultSpan"></span>
      </td>
      <td>
        <code>curl "{{.BaseURL}}/expire?domain=<span class="reg-val">{{.RegDnSet}}</span>"</code>
      </td>
    </tr>
    <tr>
      <td>6. 憑證更新特定憑證</td>
      <td><code>curl -X POST "{{.BaseURL}}/renew?domain=<span class="reg-val">{{.RegDnSet}}</span>"</code><br>
        續期後需重新下載憑證</td>
    </tr>
    <tr>
      <td>7. 憑證更新所有憑證</td>
      <td><code>curl -X POST "{{.BaseURL}}/renew"</code>
        <br>憑證中心 --force 更新所有憑證，需搭配 3. 重新下載憑證
      </td>
    </tr>
      </table>
    </div>
  </div>

  <script>
    (() => {
      const input = document.getElementById('regDnSet');
      const nodes = document.querySelectorAll('.reg-val');
      const initial = input.value;
      const render = () => {
        const v = (input.value || initial).trim();
        nodes.forEach(n => n.textContent = v);
      };
      input.addEventListener('input', render);
      render();

      const btnExpire = document.getElementById('btnExpire');
      const expireResult = document.getElementById('expireResult');
      const baseURL = document.getElementById('baseURL').textContent.trim();

      btnExpire.addEventListener('click', async () => {
        const domain = (input.value || initial).trim();
        if (!domain) {
          expireResult.textContent = '請先輸入網域';
          return;
        }
        expireResult.textContent = '檢查中...';
        try {
          const resp = await fetch(`${baseURL}/expire?domain=${encodeURIComponent(domain)}`);
          const text = await resp.text();
          expireResult.textContent = text;
        } catch (err) {
          expireResult.textContent = '檢查失敗';
        }
      });

      const btnCheckReg = document.getElementById('btnCheckReg');
      const checkResult = document.getElementById('checkResult');
      btnCheckReg.addEventListener('click', async () => {
        checkResult.textContent = '檢查中...';
        try {
          const resp = await fetch(`${baseURL}/register`);
          const text = await resp.text();
          checkResult.textContent = text;
        } catch (err) {
          checkResult.textContent = '檢查失敗';
        }
      });

      const btnIssue = document.getElementById('btnIssue');
      const issueResult = document.getElementById('issueResult');
      btnIssue.addEventListener('click', async () => {
        const domain = (input.value || initial).trim();
        if (!domain) {
          issueResult.textContent = '請先輸入網域';
          return;
        }
        issueResult.textContent = '發行中...';
        try {
          const resp = await fetch(`${baseURL}/cert?domain=${encodeURIComponent(domain)}`, {
            method: 'POST'
          });
          const text = await resp.text();
          issueResult.textContent = text;
        } catch (err) {
          issueResult.textContent = '發行失敗';
        }
      });

      const cleanResult = document.getElementById('cleanResult');
      cleanResult.addEventListener('click', () => {
        const allTexts = document.querySelectorAll('.resultSpan');
        allTexts.forEach(t => t.textContent = '');
      });






    })();
  </script>
</body>

</html>




